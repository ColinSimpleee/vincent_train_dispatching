# 列车调度模拟器 - 游戏玩法手册

> 版本：1.0 | 更新日期：2026-01-28

---

## 目录

1. [游戏概述](#1-游戏概述)
2. [基础操作](#2-基础操作)
3. [列车系统](#3-列车系统)
4. [道岔与信号](#4-道岔与信号)
5. [站台与停靠](#5-站台与停靠)
6. [物理规则](#6-物理规则)
7. [车站地图](#7-车站地图)
8. [评分机制](#8-评分机制)
9. [策略技巧](#9-策略技巧)

---

## 1. 游戏概述

### 1.1 游戏背景

你是一名车站调度员，负责指挥列车安全、准点地进出车站。通过控制道岔、信号灯，合理安排列车进站、停靠、发车，确保铁路运营顺畅。

### 1.2 游戏目标

- **安全第一**：避免列车碰撞（碰撞即游戏结束）
- **准点运营**：尽量让列车按时刻表准点到发
- **高效调度**：合理利用站台资源，提高车站吞吐量

### 1.3 界面布局

```
┌─────────────────────────────────────────────────┐
│                   游戏标题栏                      │
├──────────┬─────────────────────────┬────────────┤
│          │                         │            │
│  左面板   │       游戏画布           │   右面板    │
│          │     (轨道与列车)         │            │
│ 列车状态  │                         │  时钟/指令  │
│ & 等待队列│                         │  & 倍速     │
│          │                         │            │
└──────────┴─────────────────────────┴────────────┘
```

---

## 2. 基础操作

### 2.1 三大核心指令

| 指令 | 按钮名称 | 功能说明 | 使用时机 |
|------|---------|---------|---------|
| **ADMIT** | 允许进站 | 将等待队列中的列车放入轨道 | 选中等待中的列车时 |
| **DEPART** | 发车信号 | 下达出站命令，列车开始离站 | 列车停靠完成后（显示绿色按钮） |
| **STOP** | 紧急停车 | 立即停止列车运动 | 紧急情况下防止碰撞 |

### 2.2 交互方式

#### 选择列车
- **左面板点击**：点击列车列表中的任意项目
- **画布点击**：直接点击轨道上的列车

#### 控制道岔
- **点击道岔图标**：画布上的白色圆圈（带状态指示）
- **效果**：切换道岔方向，改变列车路由

#### 控制信号灯
- **点击信号灯**：画布上的红/绿灯图标
- **效果**：切换红绿灯状态，控制列车通行

#### 快速发车
- **点击列车头部按钮**：停靠完成的列车会显示绿色"发车"按钮

### 2.3 时间控制

| 倍速 | 说明 | 使用场景 |
|------|------|---------|
| **1x** | 正常速度 | 精细操控、关键时刻 |
| **2x** | 两倍速 | 常规调度 |
| **5x** | 五倍速 | 快速推进时间 |
| **10x** | 十倍速 | 等待列车到来 |

---

## 3. 列车系统

### 3.1 列车编号规则

**重要规则**：列车编号决定其运行方向！

| 编号类型 | 示例 | 运行方向 |
|---------|------|---------|
| **偶数** | G2, G4, D10, D12 | 上行（向右） |
| **奇数** | G1, G3, D9, D11 | 下行（向左） |

### 3.2 列车类型

| 类型前缀 | 含义 | 速度特性 |
|---------|------|---------|
| **G** | 高速动车组 | 最高速度 |
| **D** | 动车组 | 中等速度 |
| **C** | 城际列车 | 较低速度 |

### 3.3 列车车型

游戏中包含三种真实车型：

| 车型 | 外观特征 | 编组 |
|------|---------|------|
| **CR400AF** | 红色涂装（复兴号） | 8节/16节 |
| **CR400BF** | 金色涂装（复兴号） | 8节/16节 |
| **CRH380A** | 白色涂装（和谐号） | 8节/16节 |

> 约 20% 的列车为 16 节重联编组

### 3.4 列车生命周期

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 等待队列 │ → │  进站中  │ → │  停站中  │ → │  出站中  │ → │  移除   │
│ WAITING │    │ MOVING  │    │ AT_PLAT │    │ DEPART  │    │ FINISH  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
     ↓              ↓              ↓              ↓
  玩家下达       自动沿轨      乘客上下车      玩家下达
  进站指令       道行驶       (30-60秒)       发车指令
```

### 3.5 状态说明

| 状态 | 显示颜色 | 说明 |
|------|---------|------|
| **等待进站** | 灰色 | 在队列中，未进入轨道 |
| **正在进站** | 蓝色 | 从入口向站台运行 |
| **停站中** | 黄色 | 乘客上下车阶段 |
| **可以发车** | 绿色 | 停靠完成，等待指令 |
| **正在出站** | 紫色 | 离开站台向出口运行 |

---

## 4. 道岔与信号

### 4.1 道岔系统

#### 道岔类型

```
分岔道岔（列车离开时生效）        汇入道岔（列车进入时自动通过）

    ╱─────                         ─────╲
───┼                                     ┼───
    ╲─────                         ─────╱
```

#### 道岔操作

- **点击道岔**：切换到下一个路由位置（循环切换）
- **状态指示**：绿色高亮显示当前活动路由
- **生效时机**：列车**离开**道岔时根据当前状态选择路径

#### 道岔规则

1. **分岔点（Facing Point）**：列车离开道岔 → 按 `switchState` 选择出路
2. **汇入点（Trailing Point）**：列车进入道岔 → 忽略状态，直接通过

### 4.2 信号系统

#### 信号灯状态

| 状态 | 颜色 | 列车行为 |
|------|------|---------|
| **绿灯** | 🟢 | 允许通过 |
| **红灯** | 🔴 | 强制停车 |

#### 信号操作

- **点击信号灯**：切换红绿灯状态
- **使用场景**：
  - 防止列车冲突
  - 控制进站节奏
  - 为调整道岔争取时间

### 4.3 控制边界

画布上的红色圆圈标记表示**控制边界**。列车越过此边界后：

- 视为"移交控制权"
- 列车从左面板列表中消失
- 不再参与碰撞检测
- 自动驶向轨道终点后移除

---

## 5. 站台与停靠

### 5.1 自动停靠机制

当列车**首次进入**站台轨道时：

1. ⚡ 列车自动减速至停止
2. 🚪 开始乘客上下车（30-60 秒随机）
3. ✅ 完成后显示"发车"按钮
4. 🚂 等待玩家下达发车指令

### 5.2 停靠时间

| 参数 | 数值 | 实际时间（1x 速度） |
|------|------|-------------------|
| 最短停靠 | 1800 ticks | 30 秒 |
| 最长停靠 | 3600 ticks | 60 秒 |
| 发车缓冲 | 3600-5400 ticks | 60-90 秒 |

### 5.3 站台分配

- 游戏自动为进站列车分配站台
- 玩家通过调整道岔可改变实际停靠站台
- 建议将列车分散到不同站台，提高效率

---

## 6. 物理规则

### 6.1 运动参数

| 参数 | 数值 | 说明 |
|------|------|------|
| 进站速度 | 60 单位/秒 | 从入口到站台 |
| 出站速度 | 80 单位/秒 | 从站台到出口 |
| 车厢间距 | 30 单位 | 相邻车厢中心距离 |

### 6.2 碰撞检测

**碰撞条件**（任一满足即触发）：

1. **同轨道碰撞**：两列车在同一轨道上，车身发生重叠
2. **竞态碰撞**：两列车同时声称进入同一轨道

**碰撞后果**：
- 💥 游戏立即结束
- 显示碰撞警告
- 需要重新开始

### 6.3 特殊机制

#### Ghost Mode（幽灵模式）

- 轨道**没有**排他锁定
- 多列车可以同时"声称"占用同一轨道
- **只有物理碰撞才是真正的冲突**

> 这意味着你可以在保持安全距离的前提下，让列车跟随运行

#### 路径查找

- 系统使用 BFS 算法计算列车路径
- 进站路径：入口 → 指定站台
- 出站路径：站台 → 出口

---

## 7. 车站地图

### 7.1 小型教学站

**难度**：⭐

```
          ╔═══════╗     ╔═══════╗
    ┌─────╢ 1站台 ╟─────╢ 2站台 ╟─────┐
入口├─────╢       ╟─────╢       ╟─────┤出口
    │     ╚═══════╝     ╚═══════╝     │
    │     ╔═══════╗     ╔═══════╗     │
    └─────╢ 3站台 ╟─────╢ 4站台 ╟─────┘
          ╚═══════╝     ╚═══════╝
```

**特点**：
- 4 个站台
- 双岛式布局
- 适合新手学习基础操作

### 7.2 枢纽车站

**难度**：⭐⭐⭐⭐

**特点**：
- 8 个站台（规划中）
- 高车流量
- 需要精确的信号控制
- 考验调度能力

### 7.3 终点折返站

**难度**：⭐⭐⭐

```
入口 ═══╦═══ 1站台 ═══╗
        ╠═══ 2站台 ═══╣
        ╠═══ 3站台 ═══╣
        ╚═══ 4站台 ═══╝
              ↑
           缓冲器
```

**特点**：
- 阶梯型道岔布局
- 列车需要折返离开
- 需要使用反向轨道

---

## 8. 评分机制

### 8.1 评价维度

| 维度 | 指标 | 目标 |
|------|------|------|
| **安全** | 碰撞次数 | 0 次 |
| **准点** | 到发准点率 | ≥ 95% |
| **效率** | 平均停靠时间 | 尽量短 |
| **完成** | 车次完成率 | 100% |

### 8.2 晚点计算

- 系统记录每列车的预计到达时间（`scheduledTick`）
- 实际到达时间与预计对比
- 差值显示为"晚点 N 分"或"早点 N 分"

### 8.3 游戏结束条件

| 条件 | 结果 |
|------|------|
| 列车碰撞 | ❌ 游戏失败 |
| 完成所有车次 | ✅ 游戏胜利（规划中） |
| 超时 | ⏰ 时间结束（规划中） |

---

## 9. 策略技巧

### 9.1 基础策略

#### 分散站台使用

- **错误做法**：所有列车进同一站台
- **正确做法**：提前调整道岔，分散到不同站台

#### 信号灯节奏控制

- 当两车距离过近时，用红灯让后车停下
- 切换道岔时，先用红灯停住来车
- 为紧急调整争取时间

#### 倍速灵活切换

```
10x → 等待列车到来
5x  → 常规运营期间
2x  → 列车密集时段
1x  → 关键操作时刻
```

### 9.2 进阶技巧

#### 预判列车方向

- 看到偶数编号 → 向右运行
- 看到奇数编号 → 向左运行
- 提前调整道岔迎接

#### 队列优先级

- 优先处理即将超时的列车
- 预留站台给即将到来的列车
- 避免让多列车同时等待进站

#### 安全距离意识

- 同轨道列车保持至少 1 个车身距离
- 高速列车需要更大的安全裕度
- 紧急情况立即使用 STOP 指令

### 9.3 常见错误

| 错误 | 后果 | 预防方法 |
|------|------|---------|
| 忘记切换道岔 | 列车进错站台 | 进站前检查道岔状态 |
| 同时放两车进同一站台 | 碰撞 | 使用信号灯控制节奏 |
| 忽略列车编号方向 | 调度混乱 | 牢记偶数=右，奇数=左 |
| 长时间高倍速 | 反应不及 | 关键时刻切回 1x |
| 忘记发车 | 站台拥堵 | 关注"可以发车"状态 |

---

## 附录

### A. 快捷键（规划中）

| 按键 | 功能 |
|------|------|
| `Space` | 暂停/继续 |
| `1-4` | 切换倍速 |
| `A` | 允许进站 |
| `D` | 发车信号 |
| `S` | 紧急停车 |

### B. 术语表

| 术语 | 解释 |
|------|------|
| **道岔** | 轨道分岔点，控制列车路由 |
| **站台** | 列车停靠、乘客上下的区域 |
| **进路** | 列车从起点到终点的完整路径 |
| **联锁** | 道岔和信号的安全联动关系 |
| **移交** | 列车离开控制区域，交给下一调度员 |

### C. 游戏参数参考

```yaml
# 时间参数
tick_rate: 60 ticks/秒
dwell_time: 1800-3600 ticks (30-60秒)
buffer_time: 3600-5400 ticks (60-90秒)

# 速度参数
entry_speed: 60 单位/秒
exit_speed: 80 单位/秒

# 列车参数
car_pitch: 30 单位
short_train: 8 节车厢
long_train: 16 节车厢
long_train_ratio: 20%
```

---

> 祝你调度愉快！🚄
